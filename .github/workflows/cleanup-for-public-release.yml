name: Public-Release Cleanup

on:
  workflow_dispatch:   # manual trigger
  push:
    branches: [ main ]

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write           # needed to push back to main

    steps:
      - name: Checkout repository (full history)
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0          # critical for committing + pushing

      - name: Remove dev / temporary files
        run: |
          git config user.name "cleanup-bot"
          git config user.email "cleanup@riverbraid.ai"

          git rm -f --ignore-unmatch \
            .nvimrc \
            COPILOT.md \
            FOUNDRY_TARGET.md \
            lock.json \
            nightly.yml \
            pipeline.test.mjs \
            riverbraid_ledger.json \
            "terminal:" || true

          if ! git diff --staged --quiet; then
            git commit -m "chore: remove dev artifacts and temporary files"
