name: Public-Release Cleanup

on:
  workflow_dispatch:      # Lets you run it manually any time
  push:
    branches: [ main ]

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # ----- 1. Delete all the junk files we agreed on -----
      - name: Remove dev-only / temporary files
        run: |
          git config user.name "cleanup-bot"
          git config user.email "cleanup@riverbraid"

          # These are 100% safe to delete
          git rm -f --ignore-unmatch \
            .nvimrc \
            COPILOT.md \
            FOUNDRY_TARGET.md \
            lock.json \
            nightly.yml \
            pipeline.test.mjs \
            riverbraid_ledger.json \
            terminal: || true

          git commit -m "chore: remove dev artifacts and clutter" || echo "Nothing to delete"

      # ----- 2. Combine Licensing_README.md into main README -----
      - name: Merge Licensing_README.md â†’ README.md
        run: |
          if [ -f Licensing_README.md ]; then
            echo -e "\n## Licensing\n" >> README.md
            cat Licensing_README.md >> README.md
            echo -e "\n---\n*See also the full [LICENSE](./LICENSE) file.*" >> README.md
            git rm Licensing_README.md
            git add README.md
            git commit -m "docs: merge Licensing_README.md into main README"
          fi

      # ----- 3. (Optional) If you still want COPILOT notes inside CONTRIBUTING -----
      - name: Fold COPILOT.md into CONTRIBUTING.md (if it exists)
        run: |
          if [ -f COPILOT.md ] && [ -f CONTRIBUTING.md ]; then
            echo -e "\n## Using GitHub Copilot\n" >> CONTRIBUTING.md
            cat COPILOT.md >> CONTRIBUTING.md
            git rm COPILOT.md
            git commit -m "docs: move Copilot notes into CONTRIBUTING.md"
          fi

      # ----- 4. Push all changes back to main -----
      - name: Push cleanup
        run: |
          git push origin main || echo "No changes to push"
